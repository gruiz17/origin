<div ng-controller="ProjectController" class="content">
  <project-page>
    <div ng-controller="SettingsController">
      <div class="page-header page-header-bleed-right">
        <div class="actions action-button pull-right">
          <i class="fa fa-trash-o fa-2x" 
            ng-click="openDeleteModal()"
            ng-if="!deletingMap[project.metadata.name] && !confirmingMap[project.metadata.name]" 
            data-toggle="tooltip" 
            data-placement="left" 
            title="Delete Project"></i>
        </div>
        <h1>Project Settings</h1>
      </div>

      <!-- delete project modal -->
      <script type="text/ng-template" id="delete-project.html">
        <div class="modal-project-delete">
          <div class="modal-body">
            <h1>Are you sure you want to delete the project '<strong>{{$parent.project | displayName}}</strong>'?</h1>
            <p>This will <strong>delete all resources</strong> associated with the project {{$parent.project | displayName}} and <strong>cannot be undone</strong>.  Make sure this is something you really want to do!</p>
          </div>
          <div class="modal-footer">
              <button class="btn btn-lg btn-danger" type="button" ng-click="deleteProject();">Delete this project</button>
              <button class="btn btn-lg btn-default" type="button" ng-click="cancelDelete();">Cancel</button>
          </div>
        </div>
      </script>
      <!-- /delete project modal -->

      <alerts alerts="alerts"></alerts>
      <h2>General information</h2>
      <!-- TODO make these fields editable - probably with a cog icon that flips into inline-editing -->
      <dl class="dl-horizontal left">
        <dt>Name:</dt>
        <dd>{{projectName}}</dd>
        <dt>Display name:</dt>
        <dd ng-if="project | displayName: true">{{project | displayName: true}}</dd>
        <dd ng-if="!(project | displayName: true)"><em>No display name</em></dd>
        <dt>Description:</dt>
        <dd ng-if="project | description">
          <truncate-long-text content="project | description" limit="1024" use-word-boundary="true"></truncate-long-text>
        </dd>
        <dd ng-if="!(project | description)"><em>No description</em></dd>
      </dl>
      <h2>
        <span>Quota</span>
        <i style="margin-left: 5px; cursor: help;" class="small pficon pficon-help" data-toggle="tooltip" data-placement="right"
          title="Quota is enforced at the project level.  Once the maximum for the project has been reached no more of that resource can be allocated within the project."></i>
      </h2>
      <div ng-if="(quotas | hashSize) == 0"><em>{{emptyMessageQuotas}}</em></div>
      <table ng-if="(quotas | hashSize) > 0" class="table">
        <thead>
          <th>Resource type</th>
          <th>Used</th>
          <th>Max</th>
        </thead>
        <tbody ng-repeat="quota in quotas">
          <tr ng-if='!quota.status.used' class="danger">
            <td colspan="5">
              <span class="pficon-layered" data-toggle="tooltip" data-placement="right" title="Missing quota status" style="cursor: help;">
                <span class="pficon pficon-error-octagon"></span>
                <span class="pficon pficon-error-exclamation"></span>
              </span>
              Status has not been reported on this quota usage record.  Any resources limited by this quota record can not be allocated.
            </td>
          </tr>
          <tr ng-class="{warning: (quota.status.used[resourceType] | usageValue) >= (quota.status.hard[resourceType] | usageValue)}" ng-repeat="(resourceType, specMax) in quota.spec.hard">
            <!-- TODO prettify resourceType? -->
            <td>
              <span ng-if="(quota.status.used[resourceType] | usageValue) >= (quota.status.hard[resourceType] | usageValue)" class="pficon-layered" data-toggle="tooltip" data-placement="right" title="Quota limit reached" style="cursor: help;">
                <span class="pficon pficon-warning-triangle"></span>
                <span class="pficon pficon-warning-exclamation"></span>
              </span>
              {{resourceType}}
            </td>
            <td>
              <span ng-if="!quota.status.used">&mdash;</span>
              <span ng-if="quota.status.used">{{quota.status.used[resourceType] | usageWithUnits : resourceType}}</span>
            </td>
            <td>
              <span ng-if="!quota.status.hard">{{specMax  | usageWithUnits : resourceType}}</span>
              <span ng-if="quota.status.hard">{{quota.status.hard[resourceType]  | usageWithUnits : resourceType}}</span>
            </td>
          </tr>
        </tbody>
      </table>
      <h2>
        <span>Resource limits</span>
        <i style="margin-left: 5px; cursor: help;" class="small pficon pficon-help" data-toggle="tooltip" data-placement="right"
          title="Resource limits define minimum and maximum values that can be created for each resource type."></i>
      </h2>
      <div ng-if="(limitRanges | hashSize) == 0"><em>{{emptyMessageLimitRanges}}</em></div>
      <table ng-if="(limitRanges | hashSize) > 0" class="table">
        <thead>
          <th>Resource type</th>
          <th>Min</th>
          <th>Max</th>
          <th>Default</th>
        </thead>
        <tbody ng-repeat="limitRange in limitRanges">
          <tr ng-repeat-start="limit in limitRange.spec.limits"></tr>
          <tr ng-repeat="(type, min) in limit.min">
            <!-- TODO prettify type -->
            <td>{{limit.type}} {{type}}</td>
            <td>{{(min | usageWithUnits : type) || "&mdash;"}}</td>
            <td>{{(limit.max[type] | usageWithUnits : type) || "&mdash;"}}</td>
            <td>{{(limit["default"][type] | usageWithUnits : type) || "&mdash;"}}</td>
          </tr>
          <tr ng-repeat-end></tr>
        </tbody>
      </table>
    </div>
  </project-page>
</div>
